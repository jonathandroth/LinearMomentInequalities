data_output_dir1 = '../../Output/Conditional_FullMatrix/Data/Calibrated_SigmaZeta/';
data_output_dir2 = '../../Output/Conditional_OracleMatrix/Data/Calibrated_SigmaZeta/';
%data_output_dir2 = '../../Output/UnconditionalMatrix/Data/Calibrated_SigmaZeta/';
figure_output_dir = '../../Figures/Differences/FullvOracle/';
mkdir(figure_output_dir);

%Load  rejection grids cell for the first set
rejection_grids_cell1 = load( strcat( data_output_dir1, moment_type, 'grid_cell.mat') );
rejection_grids_cell1 = rejection_grids_cell1.rejection_grids_cell;

rejection_grids_cell2 = load( strcat( data_output_dir2, moment_type, 'grid_cell.mat') );
rejection_grids_cell2 = rejection_grids_cell2.rejection_grids_cell;

%Load  rejection grids cell for the second set


[rejection_prob_lf1, rejection_prob_rsw1, rejection_prob_conditional1, rejection_prob_hybrid1] = ...
    retrieve_rejection_grids_fn( rejection_grids_cell1, theta_c_grid, theta_g_grid );

[rejection_prob_lf2, rejection_prob_rsw2, rejection_prob_conditional2, rejection_prob_hybrid2] = ...
    retrieve_rejection_grids_fn( rejection_grids_cell2, theta_c_grid, theta_g_grid );


dif_lf = rejection_prob_lf1 - rejection_prob_lf2;
dif_rsw = rejection_prob_rsw1 - rejection_prob_rsw2;
dif_conditional = rejection_prob_conditional1 - rejection_prob_conditional2;
dif_hybrid = rejection_prob_hybrid1 - rejection_prob_hybrid2;

contour( xgrid, ygrid, dif_lf', [ [0,0.01,0.05,0.1,0.2], -[0,0.01,0.05,0.1,0.2], 'ShowText', 'on');
contour( xgrid, ygrid, dif_lf', 'ShowText', 'on');

title('Difference in Rejection Probabilities - Least Favorable');
xlabel('thetac');
ylabel('thetag');
saveas( gcf, strcat(figure_output_dir, 'dif_rejection_probs_lf'), 'epsc');

contour( xgrid, ygrid, dif_lf', [0,0.01,0.05,0.1,0.2], 'ShowText', 'on');

contour( xgrid, ygrid, dif_hybrid',  'ShowText', 'on');

%%

for moment_type = {'Basic_Moments/', 'Interacted_Moments/'};
%for moment_type = {'Basic_Moments/'};
    
for dirname = dirnames
    
rejection_prob_lf = zeros( length(theta_c_grid), length(theta_g_grid));
rejection_prob_rsw = rejection_prob_lf;
rejection_prob_conditional = rejection_prob_lf;
rejection_prob_hybrid = rejection_prob_lf;


ds_name = strcat( data_output_dir, dirname, moment_type, 'grid_cell');
ds_name = ds_name{:};
load(ds_name);

for ds = 1:numdatasets

%     ds_name = strcat( '../../Output/Rejection_Grids/Lambda_Constant/', dirname, moment_type, 'grid', num2str(ds));
%     ds_name = ds_name{:};
%     load(ds_name);
    if( strcmp(moment_type ,'Basic_Moments/'))
    grid_lf = rejection_grids_cell{ds,1};
    grid_rsw = rejection_grids_cell{ds,2};
    grid_conditional = rejection_grids_cell{ds,3};
    grid_hybrid = rejection_grids_cell{ds,4};
    
    else
        grid_lf = interacted_rejection_grids_cell{ds,1};
        grid_rsw = interacted_rejection_grids_cell{ds,2};
        grid_conditional = interacted_rejection_grids_cell{ds,3};
        grid_hybrid = interacted_rejection_grids_cell{ds,4};
    end
    
    rejection_prob_lf = rejection_prob_lf + grid_lf / numdatasets;
    rejection_prob_rsw = rejection_prob_rsw + grid_rsw / numdatasets;
    rejection_prob_conditional = rejection_prob_conditional + grid_conditional / numdatasets;
    rejection_prob_hybrid = rejection_prob_hybrid + grid_hybrid / numdatasets;
    
end
[ xgrid, ygrid] = meshgrid( theta_c_grid , theta_g_grid);

figure_dir = strcat( figures_output_dir, dirname, moment_type);
figure_dir = figure_dir{:};


contour( xgrid, ygrid, rejection_prob_lf', [0.05, 0.2, 0.5,0.7,0.9,0.99], 'ShowText', 'on');
